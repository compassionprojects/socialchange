<div id="<%= dom_id story %>">
  <h1>
    <%= story.title(fallback: I18n.available_locales) %>
  </h1>
  <div class="small text-muted">
    <%= time_ago(story.created_at) %> <%= t("posted_by", name: story.user.name) %>
  </div>

  <div class="row flex-lg-row flex-column-reverse">
    <div class="col-lg-9">
      <section class="my-4">
        <p>
          <%= display_rich_text(story.description) %>
        </p>
      </section>

      <section class="my-4">
        <div class="d-flex flex-wrap">
          <% story.documents.filter { |x| x.representable? }.each do |file| %>
            <div class="m-2">
              <%= link_to url_for(file), target: "_blank" do %>
                <%= image_tag file.representation(resize_to_limit: [300, 200]), class: "rounded border" %>
              <% end %>
            </div>
          <% end %>
        </div>
        <ul class="my-4 list-unstyled">
          <% story.documents.filter { |x| !x.representable? }.each do |file| %>
            <li><i class="bi bi-paperclip"></i> <%= link_to file.filename, url_for(file), target: "_blank" %></li>
          <% end %>
        </ul>
      </section>

      <% if story.outcomes %>
        <section class="my-4">
          <h2><%= t("stories.show.outcomes") %></h2>
          <p>
            <%= display_rich_text(story.outcomes) %>
          </p>
        </section>
      <% end %>

      <% if story.source %>
        <section class="my-4">
          <h2><%= t("stories.show.source") %></h2>
          <p>
            <%= display_rich_text(story.source) %>
          </p>
        </section>
      <% end %>

      <section class="my-5">
        <h2>
          <%= t("stories.show.story_updates") %>
          <%= link_to t(".new_story_update"), new_story_update_path(story),
            :class => "btn btn-sm btn-outline-primary", data: { turbo_frame: "modal" } if can_add_story_update?(story) %>
        </h2>
        <% if story.story_updates.length > 0 %>
          <%= turbo_frame_tag :story_updates do %>
            <% story.story_updates.each_with_index do |story_update, idx| %>
              <%= turbo_frame_tag dom_id(story_update) do %>
                <%= render "story_updates/list_item", story_update:, border_top: idx != 0 %>
              <% end %>
            <% end %>
          <% end %>
        <% else %>
          <i class="text-muted"><%= t(".no_story_updates") %></i>
        <% end %>
      </section>
    </div>
    <div class="col-lg-3 mt-lg-0 mt-3">
      <div class="my-2 d-flex align-items-center">
        <i class="bi bi-geo-alt"></i>
        <span class="mx-2"><%= story.country_name %></span>
      </div>
      <% if story.documents.attached? %>
        <div class="my-2 d-flex align-items-center">
          <i class="bi bi-paperclip"></i>
          <span class="mx-2"><%= t('.num_attached_documents', count: story.documents.length) %></span>
        </div>
      <% end %>
      <% if story.story_updates.length > 0 %>
        <div class="my-2 d-flex align-items-center">
          <i class="bi bi-megaphone"></i>
          <span class="mx-2"><%= t('.num_story_updates', count: story.story_updates.length) %></span>
        </div>
      <% end %>
      <div class="my-2 d-flex align-items-start">
        <i class="bi bi-translate"></i>
        <span class="mx-2">
          <%= t(".translations_available_in_html", languages: story.translated_in.map { |x| link_to t("locales.#{x}"), story_path(story, lang: x), class: "text-success" }.join(", ").html_safe) %>
        </span>
      </div>
      <% if story.missing_translations.length > 0 %>
        <div class="border border-warning my-lg-5 mt-4 rounded p-3">
          <%= t('.translations_missing_for_html', languages: story.missing_translations.map { |x| content_tag :span, t("locales.#{x}"), class: "text-warning" }.join(", ").html_safe) %>
        </div>
      <% end %>
    </div>
  </div>
</div>
